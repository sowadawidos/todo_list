var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=MainPage;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _Task=_interopRequireDefault(require("../Task"));var _TaskInput=_interopRequireDefault(require("../../components/TaskInput"));var _styles=require("../../styles");var _theme=require("../../theme");var _api=require("../../api");var _LoadingIndicator=_interopRequireDefault(require("../../components/LoadingIndicator"));var _ErrorFetchModal=_interopRequireDefault(require("../../components/ErrorFetchModal"));var _jsxFileName="/Users/dawidsowinski/Documents/FamGenix/todo_list/src/screens/MainPage/index.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function MainPage(){var _this=this;var _useState=(0,_react.useState)([]),_useState2=(0,_slicedToArray2.default)(_useState,2),tasks=_useState2[0],setTasks=_useState2[1];var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2.default)(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=(0,_react.useState)(false),_useState6=(0,_slicedToArray2.default)(_useState5,2),isFetchError=_useState6[0],setIsFetchError=_useState6[1];var _useState7=(0,_react.useState)(null),_useState8=(0,_slicedToArray2.default)(_useState7,2),intervalId=_useState8[0],setIntervalId=_useState8[1];var _useState9=(0,_react.useState)(''),_useState10=(0,_slicedToArray2.default)(_useState9,2),loadingMsg=_useState10[0],setLoadingMsg=_useState10[1];var _useState11=(0,_react.useState)(false),_useState12=(0,_slicedToArray2.default)(_useState11,2),isFilteringTasks=_useState12[0],setIsFilteringTasks=_useState12[1];var _useState13=(0,_react.useState)([]),_useState14=(0,_slicedToArray2.default)(_useState13,2),filteredTasks=_useState14[0],setFilteredTasks=_useState14[1];var flatListData=isFilteringTasks?filteredTasks.sort(function(a,b){return Number(-a.id)+Number(b.id);}):tasks.sort(function(a,b){return Number(-a.id)+Number(b.id);});var switchButtonText=isFilteringTasks?'Show all tasks':'Show done tasks';var areTasksEmpty=tasks.length===0&&!isLoading;var emptyTasksText=isFilteringTasks?'No task completed':'No task today';var toggleSwitch=function toggleSwitch(){var filteredTasks=tasks.filter(function(task){return task.done==='TRUE';});setIsFilteringTasks(function(prev){return!prev;});setFilteredTasks(filteredTasks);};var setLoadingMessage=function setLoadingMessage(){var customText=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var textLoadingMessage=['Loading data','Wait a moment','Give us a moment'];var textForLoading=!customText?textLoadingMessage:[customText];var intervalValue=500;var intervalIdVal=setInterval(function(){var randomTextValue=textForLoading[Math.floor(Math.random()*textForLoading.length)];setLoadingMsg(randomTextValue);},intervalValue);setIntervalId(intervalIdVal);};var renderItem=function renderItem(_ref){var item=_ref.item;return _react.default.createElement(_Task.default,{task:item,fetchTodoList:fetchTodoList,setIsLoading:setIsLoading,setIsFetchError:setIsFetchError,__self:_this,__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:13}});};var fetchTodoList=function fetchTodoList(){var loadingMessage,response,_args=arguments;return _regenerator.default.async(function fetchTodoList$(_context){while(1){switch(_context.prev=_context.next){case 0:loadingMessage=_args.length>0&&_args[0]!==undefined?_args[0]:'';if(isFetchError)setIsFetchError(false);setLoadingMessage(loadingMessage);setIsLoading(true);_context.prev=4;_context.next=7;return _regenerator.default.awrap((0,_api.fetchData)('get'));case 7:response=_context.sent;if(!(!response.data||response.isFetchError)){_context.next=10;break;}throw Error;case 10:setTimeout(function(){setTasks(response.data);setIsLoading(false);},3000);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context["catch"](4);setTimeout(function(){setIsFetchError(true);setIsLoading(false);},3000);case 16:case"end":return _context.stop();}}},null,null,[[4,13]],Promise);};(0,_react.useEffect)(function(){if(intervalId&&isLoading)return;clearInterval(intervalId);},[isLoading]);(0,_react.useEffect)(function(){fetchTodoList();},[]);if(isLoading)return _react.default.createElement(_LoadingIndicator.default,{message:loadingMsg,style:_styles.styles.loader,color:_theme.colors.PLACEHOLDER_COLOR,size:'large',__self:this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:13}});return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_reactNative.View,{style:_styles.styles.mainPageBox,__self:this,__source:{fileName:_jsxFileName,lineNumber:130,columnNumber:13}},isFetchError&&_react.default.createElement(_ErrorFetchModal.default,{pressAction:fetchTodoList,__self:this,__source:{fileName:_jsxFileName,lineNumber:132,columnNumber:21}}),_react.default.createElement(_reactNative.View,{style:_styles.styles.taskBox,__self:this,__source:{fileName:_jsxFileName,lineNumber:135,columnNumber:17}},_react.default.createElement(_reactNative.KeyboardAvoidingView,{behavior:_reactNative.Platform.OS==='ios'?'padding':'height',__self:this,__source:{fileName:_jsxFileName,lineNumber:136,columnNumber:21}},_react.default.createElement(_reactNative.View,{style:_styles.styles.inputBox,__self:this,__source:{fileName:_jsxFileName,lineNumber:139,columnNumber:25}},_react.default.createElement(_TaskInput.default,{taskCount:tasks.length,fetchTodoList:fetchTodoList,setIsLoading:setIsLoading,setIsFetchError:setIsFetchError,__self:this,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:29}}),_react.default.createElement(_reactNative.View,{style:_styles.styles.switchBox,__self:this,__source:{fileName:_jsxFileName,lineNumber:148,columnNumber:29}},_react.default.createElement(_reactNative.Text,{style:{marginRight:15},__self:this,__source:{fileName:_jsxFileName,lineNumber:149,columnNumber:33}},switchButtonText),_react.default.createElement(_reactNative.Switch,{trackColor:{false:_theme.colors.SWITCH_FALSE_COLOR,true:_theme.colors.SWITCH_TRUE_COLOR},thumbColor:isFilteringTasks?_theme.colors.IS_ENABLED_TRUE_COLOR:_theme.colors.IS_ENABLED_FALSE_COLOR,ios_backgroundColor:"#3e3e3e",onValueChange:toggleSwitch,value:isFilteringTasks,__self:this,__source:{fileName:_jsxFileName,lineNumber:153,columnNumber:33}})))),areTasksEmpty&&_react.default.createElement(_reactNative.Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:171,columnNumber:39}},emptyTasksText),_react.default.createElement(_reactNative.FlatList,{data:flatListData,renderItem:renderItem,keyExtractor:function keyExtractor(item){return item.id;},__self:this,__source:{fileName:_jsxFileName,lineNumber:173,columnNumber:21}}))));}